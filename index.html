<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kubernetes Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f6f8;
            margin: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .question-block {
            background: #fff;
            margin: 24px auto;
            padding: 20px 24px;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.08);
        }
        .question-title {
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        .options-list {
            margin: 0 0 0 20px;
            padding: 0;
        }
        .options-list li {
            margin-bottom: 6px;
        }
        input[type="file"] {
            display: block;
            margin: 0 auto 20px;
        }
    </style>
</head>
<body>

<h1>KCNA EXAM QUESTIONS</h1>
<div id="table-container"></div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
    // Automatically load and display quiz.csv if present
    fetch('quiz.csv')
        .then(response => response.text())
        .then(csvText => {
            Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    renderQuiz(results.data);
                }
            });
        });

    function renderQuiz(questions) {
        const container = document.getElementById('table-container');
        container.innerHTML = '';
        questions.forEach((q, idx) => {
            const block = document.createElement('div');
            block.className = 'question-block';
            block.innerHTML = `
                <div class="question-title">${idx + 1}. ${q['Question']}</div>
                <ul class="options-list">
                    <li>A. ${q['Option A']}</li>
                    <li>B. ${q['Option B']}</li>
                    <li>C. ${q['Option C']}</li>
                    <li>D. ${q['Option D']}</li>
                    ${q['Option E'] ? `<li>E. ${q['Option E']}</li>` : ''}
                </ul>
                <button type="button" onclick="const ans=this.nextElementSibling;ans.style.display=ans.style.display==='none'?'block':'none';this.textContent=ans.style.display==='none'?'Show Answer':'Hide Answer';">Show Answer</button>
                <div style="color:#888;font-size:0.95em;margin-top:8px; display:none;">
                    <strong>Answer:</strong> ${q['Correct Answer']}<br>
                    <strong>Explanation:</strong> ${q['Explanation']}
                </div>
                <div style="color:#aaa;font-size:0.85em;margin-top:4px;">
                    <strong>Domain:</strong> ${q['Domain']} | <strong>Competency:</strong> ${q['Competency']}
                </div>
            `;
            container.appendChild(block);
        });
    }
</script>
<script>
    document.getElementById('upload').addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
            const text = e.target.result;
            const rows = text.split('\n').map(row => row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
            const headers = rows[0].map(h => h.trim().replace(/"/g, ''));
            let html = '';

            // Find indices for extra fields
            const idxAnswer = headers.findIndex(h => h.toLowerCase().includes('correct answer'));
            const idxExplanation = headers.findIndex(h => h.toLowerCase().includes('explanation'));
            const idxDomain = headers.findIndex(h => h.toLowerCase().includes('domain'));
            const idxCompetency = headers.findIndex(h => h.toLowerCase().includes('competency'));

            for (let i = 1; i < rows.length; i++) {
                if (rows[i].length === headers.length) {
                    const cells = rows[i].map(cell => cell.trim().replace(/"/g, ''));
                    html += `<div class="question-block">`;
                    html += `<div class="question-title">Q${i}: ${cells[0]}</div>`;
                    html += `<ol class="options-list" type="A">`;
                    for (let j = 1; j < cells.length; j++) {
                        // Stop at empty cell or if header is one of the extra fields
                        if (!cells[j] || [idxAnswer, idxExplanation, idxDomain, idxCompetency].includes(j)) break;
                        html += `<li>${cells[j]}</li>`;
                    }
                    html += `</ol>`;
                    if (idxAnswer !== -1 && cells[idxAnswer]) {
                        html += `<div><strong>Correct Answer:</strong> ${cells[idxAnswer]}</div>`;
                    }
                    if (idxExplanation !== -1 && cells[idxExplanation]) {
                        html += `<div><strong>Explanation:</strong> ${cells[idxExplanation]}</div>`;
                    }
                    if (idxDomain !== -1 && cells[idxDomain]) {
                        html += `<div><strong>Domain:</strong> ${cells[idxDomain]}</div>`;
                    }
                    if (idxCompetency !== -1 && cells[idxCompetency]) {
                        html += `<div><strong>Competency:</strong> ${cells[idxCompetency]}</div>`;
                    }
                    html += `</div>`;
                }
            }

            document.getElementById('table-container').innerHTML = html;
        };
        reader.readAsText(file);
    });
</script>

</body>
</html>
